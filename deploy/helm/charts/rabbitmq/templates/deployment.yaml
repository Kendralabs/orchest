{{/*
deployment
*/}}
---
{{ include "library.deployment" . }}
    spec:
      volumes:
        - name: mnesia
          hostPath:
            path: /var/lib/orchest/userdir/.orchest/rabbitmq-mnesia
            type: DirectoryOrCreate                      
      containers:
      - name: rabbitmq-server
        image: rabbitmq:3
        {{ if .Values.service.port}}
        ports:
        - containerPort: {{ .Values.service.port }}
        {{ end }}
        volumeMounts:
         - name: mnesia
           mountPath: /var/lib/rabbitmq/mnesia
        readinessProbe:
          exec:
            command:
              - su
              - rabbitmq
              - -c
              - "/opt/rabbitmq/sbin/rabbitmq-diagnostics ping"
          initialDelaySeconds: 5
          periodSeconds: 5
          timeoutSeconds: 5
          successThreshold: 1
          failureThreshold: 40